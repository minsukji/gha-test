name: Pull request tests

on:
  push:
    branches:
    - master

jobs:
  job1:
    name: preliminary
    runs-on: ubuntu-latest

    outputs:
      output1: ${{ steps.pstep.outputs.test }}

    steps:
    - name: checkout
      uses: actions/checkout@v2

    - name: cases to run
      id: pstep
      run: |
        #TESTS=$(cut -d "," -f 1 ${GITHUB_WORKSPACE}/tests.txt)
        TESTS=$(cat ${GITHUB_WORKSPACE}/tests.txt)
        echo "::set-output name=test::${TESTS}"
        

  job2:
    name: ${{ matrix.kind }} test
    needs: job1
    runs-on: ubuntu-latest

    strategy:
      matrix:
        #kind: [rst]
        kind: [${{needs.job1.outputs.output1}}]

    steps:
    - name: checkout
      uses: actions/checkout@v2

    - name: step 1
      run: |
        cd ${GITHUB_WORKSPACE}
        ls -l
        ./hello.sh ${{ matrix.kind }}
        echo "${{needs.job1.outputs.output1}}"

    - name: step 2
      run: echo "${{ matrix.kind }}"
